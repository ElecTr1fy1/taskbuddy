"'use client';\n\nimport { Task, PRIORITY_COLORS } from '@/lib/types';\nimport { useState, useRef } from 'react';\nimport ScoreBadge from './ScoreBadge';\n\ninterface TaskCardProps {\n  task: Task;\n  onComplete: (taskId: string) => void;\n  onTap: (taskId: string) => void;\n  onArchive?: (taskId: string) => void;\n  categoryColor?: string;\n}\n\nfunction formatTimeEstimate(minutes: number): string {\n  if (minutes >= 60) {\n    const hours = Math.floor(minutes / 60);\n    const mins = minutes % 60;\n    if (mins === 0) return `${hours}h`;\n    return `${hours}h ${mins}m`;\n  }\n  return `${minutes}m`;\n}\n\nexport default function TaskCard({\n  task,\n  onComplete,\n  onTap,\n  onArchive,\n  categoryColor = '#D1D5DB',\n}: TaskCardProps) {\n  const [startX, setStartX] = useState(0);\n  const [offsetX, setOffsetX] = useState(0);\n  const [swiped, setSwiped] = useState<'complete' | 'archive' | null>(null);\n  const cardRef = useRef<HTMLDivElement>(null);\n\n  const handleTouchStart = (e: React.TouchEvent) => {\n    setStartX(e.touches[0].clientX);\n  };\n\n  const handleTouchMove = (e: React.TouchEvent) => {\n    const currentX = e.touches[0].clientX;\n    const diff = currentX - startX;\n    setOffsetX(diff);\n  };\n\n  const handleTouchEnd = () => {\n    if (offsetX > 50) {\n      setSwiped('complete');\n      setTimeout(() => onComplete(task.id), 300);\n    } else if (offsetX < -50) {\n      setSwiped('archive');\n      setTimeout(() => onArchive?.(task.id), 300);\n    }\n    setOffsetX(0);\n  };\n\n  const priorityColor =\n    task.priority && PRIORITY_COLORS[task.priority]\n      ? PRIORITY_COLORS[task.priority]\n      : '#D1D5DB';\n\n  return (\n    <div\n      ref={cardRef}\n      className={`relative overflow-hidden glass-card task-enter transition-all duration-300 ${\n        swiped === 'complete' ? 'bg-green-50/80' : swiped === 'archive' ? 'bg-gray-50/80' : ''\n      }`}\n      onTouchStart={handleTouchStart}\n      onTouchMove={handleTouchMove}\n      onTouchEnd={handleTouchEnd}\n    >\n      {/* Priority accent */}\n      <div\n        className=\"absolute left-0 top-0 bottom-0 w-[3px] rounded-l-2xl\"\n        style={{ backgroundColor: priorityColor }}\n      />\n\n      {/* Reveal backgrounds */}\n      {swiped === 'complete' && (\n        <div className=\"absolute inset-0 bg-green-100/80 flex items-center justify-end pr-4\">\n          <span className=\"text-green-700 font-semibold text-sm\">Done</span>\n        </div>\n      )}\n      {swiped === 'archive' && (\n        <div className=\"absolute inset-0 bg-gray-200/80 flex items-center justify-start pl-4\">\n          <span className=\"text-gray-700 font-semibold text-sm\">Archive</span>\n        </div>\n      )}\n\n      {/* Main content */}\n      <div\n        className=\"relative px-4 py-3.5 flex gap-3 items-center\"\n        style={{ transform: `translateX(${offsetX}px)` }}\n      >\n        {/* Checkbox */}\n        <button\n          onClick={(e) => { e.stopPropagation(); onComplete(task.id); }}\n          className=\"flex-shrink-0 w-6 h-6 rounded-full border-2 flex items-center justify-center transition-all\"\n          style={{\n            borderColor: task.status === 'completed' ? priorityColor : '#D1D5DB',\n            backgroundColor: task.status === 'completed' ? priorityColor : 'transparent',\n          }}\n          aria-label=\"Complete task\"\n        >\n          {task.status === 'completed' && (\n            <svg className=\"w-3.5 h-3.5 text-white\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n              <path fillRule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clipRule=\"evenodd\" />\n            </svg>\n          )}\n        </button>\n\n        {/* Main content area */}\n        <div\n          className=\"flex-1 min-w-0 cursor-pointer\"\n          onClick={() => onTap(task.id)}\n        >\n          <h3 className={`text-sm font-semibold leading-tight ${\n            task.status === 'completed'\n              ? 'line-through text-gray-400 dark:text-gray-500'\n              : 'text-gray-900 dark:text-[#F0EDE8]'\n          }`}>\n            {task.title}\n          </h3>\n\n          {/* Meta: category + time */}\n          <div className=\"flex items-center gap-2 mt-1\">\n            {task.category && (\n              <div className=\"flex items-center gap-1.5\">\n                <div className=\"w-2 h-2 rounded-full\" style={{ backgroundColor: categoryColor }} />\n                <span className=\"text-xs text-gray-500 dark:text-gray-400\">{task.category}</span>\n              </div>\n            )}\n          </div>\n        </div>\n\n        {/* Right side: score + time */}\n        <div className=\"flex items-center gap-2.5 flex-shrink-0\">\n          <ScoreBadge score={task.smart_score} />\n          {task.estimated_minutes != null && (\n            <span className=\"text-xs font-semibold text-gray-500 dark:text-gray-400 tabular-nums\">\n              {formatTimeEstimate(task.estimated_minutes)}\n            </span>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}"